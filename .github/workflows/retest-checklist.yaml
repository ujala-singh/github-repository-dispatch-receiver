name: Rerun the test Checklist

on:
  pull_request:
    types:
      - synchronize
    branches:
      - main
    paths:
      - charts/values.yaml

jobs:
  rebase:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
        with:
          token: ${{ secrets.MY_PAT }}
          fetch-depth: 0

      - name: Add PR Comment
        run: |
          # Extract the PR number from the pull request
          PR_NUMBER="${{ github.event.pull_request.number }}"
          PR_URL="${{ github.event.pull_request.html_url }}"

          # Create the comment body
          COMMENT_BODY="A new commit has been added to the pull request, indicating an update to the image tag. Before proceeding, please ensure thorough testing of these changes in the staging environment. Mark the testing checklist below accordingly:

          ## Testing Checklist

          Changes tested on:
          - [ ] Development
          - [ ] Production
          - [ ] [MABL Tests Link] (if applicable)
          - [ ] [Successful Workflow Links] (if applicable)"

          # Add a comment to the PR using the GitHub REST API
          curl -X POST -s -H "Authorization: Bearer $GH_TOKEN" \
               -H "Content-Type: application/json" \
               -d "{\"body\":\"$COMMENT_BODY\"}" \
               "$PR_URL/comments"
        env:
          GH_TOKEN: ${{ secrets.MY_PAT }}
